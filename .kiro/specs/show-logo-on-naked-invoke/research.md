# 調査および設計決定ログ

---
**目的**: 技術設計の根拠となる、発見事項、アーキテクチャ調査、および論理的根拠を記録します。
---

## 概要
- **フィーチャー**: `show-logo-on-naked-invoke`
- **ディスカバリースコープ**: シンプルな追加
- **主要な発見事項**:
  - `typer`の`@app.callback()`デコレータが、コマンド処理前にロジックを注入するための最適なエントリポイントである。
  - `typer.Context`オブジェクトの`invoked_subcommand`属性を利用することで、サブコマンドが呼び出されていない「ネイキッド呼び出し」状態を確実に検出できる。
  - `rich`ライブラリが既にプロジェクトに導入されており、ターミナルへのスタイリングされた出力に適している。

## 調査ログ

### トピック: ネイキッド呼び出しの検出方法
- **コンテキスト**: サブコマンドなしでCLIが実行されたことを特定する必要があった。
- **調査したソース**: `typer`の公式ドキュメント。
- **発見事項**: `@app.callback()`で装飾された関数に`ctx: typer.Context`引数を追加することで、コンテキストオブジェクトにアクセスできる。`ctx.invoked_subcommand`が`None`の場合、サブコマンドは呼び出されていない。
- **影響**: このアプローチにより、ロゴ表示ロジックを他のコマンドから分離し、意図した通りのタイミングで確実に実行できる。

## 設計決定

### 決定: `typer.Context`を使用したロジック分岐
- **コンテキスト**: 要求事項1.1および1.2（引数なしの場合のみロゴを表示）を満たすための堅牢な方法が必要だった。
- **検討した代替案**:
  1. `sys.argv`を直接パースする - `typer`の抽象化を壊すため、脆弱でメンテナンス性が低い。
- **選択したアプローチ**: `main`コールバック関数で`typer.Context`を受け取り、`if ctx.invoked_subcommand is None:`の条件分岐でロゴ表示ロジックを呼び出す。
- **論理的根拠**: `typer`フレームワークの標準的な方法であり、クリーンで意図が明確になる。
- **トレードオフ**: 特になし。これはフレームワークが意図した利用方法である。