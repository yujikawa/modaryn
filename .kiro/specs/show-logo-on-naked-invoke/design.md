# 技術設計書

## 概要
この機能は、`modaryn` CLIを引数なしで実行した際に、ASCIIアートのロゴを表示します。これにより、ユーザーはツールが正しくインストールされていることを視覚的に確認できます。この変更は主にCLIのエントリポイントに影響を与え、表示ロジックは専用のモジュールに分離されます。

### ゴール
- 引数なしの`modaryn`実行時にロゴを表示する。
- ロゴ表示ロジックを既存のコマンド機能から分離する。
- ロゴのコンテンツを管理しやすくするため、テキストファイルとして外部化する。

### 非ゴール
- ロゴのデザイン自体の作成。
- ロゴ表示以外のCLIの動作変更。

## アーキテクチャ

### 既存アーキテクチャの分析
`modaryn`は`typer`ライブラリ上に構築されたCLIアプリケーションです。`modaryn/cli.py`がエントリポイントとして機能し、`@app.callback()`デコレータを持つ`main`関数がすべてのコマンド実行前に呼び出されます。この既存の構造が、新しいロゴ表示ロジックの注入ポイントとして最適です。

### アーキテクチャパターンと境界マップ
この変更は非常に限定的であり、既存のアーキテクチャに準拠します。新しい表示ロジックを`modaryn/outputs`レイヤーに追加し、プレゼンテーションに関する関心事を分離するという既存のパターンに従います。

```mermaid
graph TD
    subgraph CLI Entrypoint
        A[cli.py: main(ctx)]
    end
    subgraph Output Layer
        B[outputs/logo.py: display_logo()]
        C[assets/logo.txt]
    end

    A -- "if ctx.invoked_subcommand is None" --> B
    B -- "reads" --> C
```

**アーキテクチャ統合**:
- **選択したパターン**: 既存のレイヤードアーキテクチャを拡張します。
- **ドメイン/フィーチャー境界**: `cli.py`が呼び出しのコンテキストを判断し、`outputs/logo.py`が表示を担当することで、関心事を分離します。
- **ステアリング準拠**: `modaryn/outputs`に出力関連のロジックを配置する`structure.md`の原則に準拠しています。

### 技術スタック

| レイヤー | 選択 / バージョン | 機能における役割 | ノート |
|---|---|---|---|
| Frontend / CLI | Typer | コマンドライン引数の解釈とコールバックのトリガー | `typer.Context`を使用して呼び出し状態を判断 |
| Frontend / CLI | Rich | ターミナルへのスタイリングされたロゴの出力 | 既存の依存関係を活用 |

## 要求事項トレーサビリティ

| 要求事項 | 概要 | コンポーネント |
|---|---|---|
| 1.1 | 引数なしでロゴ表示 | `cli.py`, `outputs/logo.py` |
| 1.2 | 引数ありでロゴ非表示 | `cli.py` |
| 2.1 | ヘルプ表示を優先 | `cli.py` (Typerのデフォルト動作) |
| 3.1 | ロゴを外部ファイルで定義 | `assets/logo.txt`, `outputs/logo.py` |
| 3.2 | richを使用してスタイリング | `outputs/logo.py` |

## コンポーネントとインターフェース

### `cli` レイヤー

#### `modaryn/cli.py`
- **責務**: CLIのエントリポイントとして、引数を解釈し、ロゴを表示するか、または指定されたサブコマンドを実行するかを決定する。
- **変更点**:
  - `main`関数が`ctx: typer.Context`を受け取るように変更。
  - `ctx.invoked_subcommand`が`None`の場合に`display_logo()`を呼び出すロジックを追加。

### `outputs` レイヤー

#### `modaryn/outputs/logo.py` (新規)
- **責務**: ロゴの表示ロジックをカプセル化する。
- **インターフェース**:
  ```python
  def display_logo():
      """
      アセットファイルからASCIIロゴを読み込み、コンソールに表示する。
      """
      # 実装の詳細
  ```

### `assets` レイヤー

#### `modaryn/assets/logo.txt` (新規)
- **責務**: 表示されるASCIIアートのロゴ文字列を保持する。
- **フォーマット**: プレーンテキスト。

## テスト戦略
- **ユニットテスト**:
  - `outputs/logo.py`の`display_logo`関数が、`logo.txt`の内容を正しく読み込み、`rich.print`を呼び出すことを検証する（`print`はモックする）。
- **統合テスト**:
  - `typer`の`CliRunner`を使用して、`modaryn`を引数なしで実行した場合にロゴが表示される（標準出力をキャプチャして検証）。
  - `modaryn score`のように引数付きで実行した場合に、ロゴが表示*されない*ことを検証する。